(()=>{"use strict";var t={d:(e,r)=>{for(var a in r)t.o(r,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:r[a]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};t.d({},{L:()=>$});class e{constructor(){this.board=[],this.storeShip=new Map,this.missedHits=[],this.trackAttacks=new Set,this.boardSize=10}createBoard(){for(let t=0;t<this.boardSize;t++)this.board[t]=new Array(this.boardSize).fill("0")}placeShip(t,e){if(t.length!==e.length)throw new Error("Ship length does not match the number of provided coordinates");e.forEach((([e,r])=>{this.board[e][r]="■",this.storeShip.set(`${e},${r}`,t)}))}receiveAttack(t,e){const r=this.storeShip.get(`${t},${e}`);return this.trackAttacks.add(`${t},${e}`),r?(r.hit(t,e),this.board[t][e]="hit"):(this.board[t][e]="miss",this.missedHits.push([t,e])),r}allSunk(){const t=new Set(this.storeShip.values());for(const e of t)if(!e.isSunk())return!1;return!0}resetBoard(){for(let t=0;t<this.boardSize;t++)this.board[t].fill("0");this.storeShip.clear(),this.trackAttacks.clear(),this.missedHits=[]}}class r{constructor(t=!1){this.gameboard=new e,this.isComputer=t}}const a=new r,s=new r(!0);a.gameboard.createBoard(),s.gameboard.createBoard();const i=document.querySelector("#real-player-board"),o=document.querySelector("#computer-board"),n=document.querySelector(".playerShips"),l=document.querySelector(".restart-btn"),h=document.querySelector(".winner-msg"),c=document.querySelector(".real-player-status"),d=document.querySelector(".computer-player-status"),u=document.querySelectorAll(".row-labels.real-label, .col-labels.real-label"),p=document.querySelectorAll(".row-labels.computer-label, .col-labels.computer-label"),m=["Destroyer","Submarine","Cruiser","Battleship","Carrier"];let g={},S=null,b=0;function v(t,e){const r=t.board;e.innerHTML="";for(let t=0;t<10;t++){const a=document.createElement("div");a.classList.add("row"),e.appendChild(a);for(let e=0;e<10;e++){const s=document.createElement("div");s.classList.add("column"),s.setAttribute("data-row",t),s.setAttribute("data-col",e),f(r[t][e],s),a.appendChild(s)}}}function y(){n.innerHTML="",[2,3,3,4,5].forEach(((t,e)=>{const r=e+1,a=document.createElement("div");a.classList.add("shipWrapper",`wrapper${r}`);const s=document.createElement("div");s.id=`ship${r}`,s.setAttribute("draggable",!0),s.setAttribute("data-length",t),s.setAttribute("data-orientation","horizontal");const i=document.createElement("span");i.classList.add("shipName"),i.textContent=m[e];for(let e=0;e<t;e++){const t=document.createElement("div");t.classList.add("cell"),t.setAttribute("data-index",e),s.appendChild(t)}s.appendChild(i),a.appendChild(s),n.appendChild(a)})),document.querySelectorAll("[id^='ship']").forEach((t=>{let e=0;t.addEventListener("mousedown",(t=>{const r=t.target.closest(".cell");r&&(e=Number(r.getAttribute("data-index")))})),t.addEventListener("dragstart",(r=>{S=t.id,b=e,r.dataTransfer.setData("offset",e.toString()),r.dataTransfer.setData("shipID",t.id)}))}))}function f(t,e){switch(t){case"■":e.classList.add("ship");break;case"hit":e.classList.add("hit");break;case"miss":e.classList.add("miss");break;case"sunk":e.classList.remove("hit"),e.classList.add("sunk")}}function L(t,e=!1){const r=t.isComputer,a=document.querySelector(".random-btn"),s=document.querySelector(".rotate-btn"),n=document.querySelector(".restart-btn");s.classList.add("disable","dim"),n.classList.add("disable","dim"),o.classList.toggle("disable",r),o.classList.toggle("dim",r&&!e),i.classList.toggle("dim",!r||e),u.forEach((t=>t.classList.toggle("dim",!r||e))),p.forEach((t=>t.classList.toggle("dim",r&&!e))),d.textContent="",c.textContent="",e?r?(d.textContent="Computer is placing their ships...",o.classList.remove("dim"),p.forEach((t=>t.classList.remove("dim"))),a.classList.add("disable","dim")):(c.textContent="Place your ships on the board!",o.classList.add("disable","dim"),i.classList.remove("dim"),a.classList.remove("disable","dim"),s.classList.remove("disable","dim")):(r?c.textContent="Computer is attacking...":d.textContent="Attack the computer!",n.classList.remove("disable","dim"))}function w(t){return[Number(t.getAttribute("data-row")),Number(t.getAttribute("data-col"))]}function P(t){t.style.maxWidth="0",t.style.opacity="0",setTimeout((()=>t.remove()),300)}function A(t){const e=t.target,r=Number(e.getAttribute("data-row")),a=Number(e.getAttribute("data-col")),s=t.dataTransfer.getData("shipID"),i=document.getElementById(s)??document.getElementById(S),o=Number(i.getAttribute("data-length")),n=t.dataTransfer.getData("offset");return{row:r,col:a,shipEl:i,offset:""!==n?Number(n):b,shipLength:o}}function k(t,e,r,a){const s=r.getAttribute("data-orientation"),i=Number(r.getAttribute("data-length")),o="horizontal"===s,n=o?t:t-a,l=o?e-a:e;return $.playerShipPlacer.getShipCoordinates(n,l,i,o)}function C(){document.querySelectorAll("[id^='ship']").forEach((t=>{t.addEventListener("mousedown",(t=>{const e=t.target.closest("[id^='ship']");document.querySelectorAll(".highlightShip").forEach((t=>{t.classList.remove("highlightShip")})),e.classList.add("highlightShip")}))}))}function E(){const t=document.querySelector("[id^='ship'].highlightShip"),e=document.querySelector("[id^='ship'].highlightShip .shipName");if(!t)return;const r=t.id,a=!g[r];g[r]=a,a?(t.setAttribute("data-orientation","vertical"),t.classList.add("rotated"),e.style.transform="rotate(-90deg)"):(t.setAttribute("data-orientation","horizontal"),t.classList.remove("rotated"),e.style.transform="rotate(0deg)")}function I(){const t=document.querySelector(".rotate-btn"),e=t.cloneNode(!0);t.parentNode.replaceChild(e,t),e.addEventListener("click",E)}function T(){const t=document.querySelectorAll(".shipWrapper"),e=document.querySelector(".random-btn"),r=e.cloneNode(!0);e.parentNode.replaceChild(r,e),r.addEventListener("click",(()=>function(t,e){$.playerShipPlacer.allPlaced()||(a.gameboard.resetBoard(),$.playerShipPlacer.placeComputerShips(),t.forEach((t=>P(t))),v(a.gameboard,i),e.style.cursor="default",document.querySelector(".restart-btn").classList.add("disable","dim"))}(t,r)))}function q(){l.classList.remove("restart-btn-shadow"),h.style.display="none",i.classList.remove("player-shadow"),o.classList.remove("computer-shadow"),$.reset(),g={},v(a.gameboard,i),v(s.gameboard,o),y(),C(),I(),T(),L(a,!0),$.startSetup(),document.querySelector(".restart-btn").classList.add("disable","dim")}class x{constructor(t){this.boardSize=t.boardSize,this.oppGameboard=t,this.lastHit=null,this.nextTarget=null,this.currTargetShip=null}isValidAttack(t,e){return t>=0&&t<this.boardSize&&e>=0&&e<this.boardSize&&!this.oppGameboard.trackAttacks.has(`${t},${e}`)}computerAttacks(){let t;this.nextTarget?(t=this.nextTarget,this.nextTarget=null):t=this.lastHit?this.targetShip(this.lastHit):this.huntShip();const[e,r]=t,a=`${e},${r}`,s=this.oppGameboard.storeShip.get(a);return this.oppGameboard.receiveAttack(e,r),this.updateAttackState(s,e,r),[e,r]}getRanCoordinate(t,e){return[Math.floor(Math.random()*(e-t+1)+t),Math.floor(Math.random()*(e-t+1)+t)]}huntShip(){let t;for(;t=this.getRanCoordinate(0,this.boardSize-1),!this.isValidAttack(t[0],t[1]););return t}targetShip(t){const[e,r]=t,a=[[-1,0],[1,0],[0,-1],[0,1]].sort((()=>Math.random()-.5));for(const[t,s]of a){const a=e+t,i=r+s;if(this.isValidAttack(a,i))return[a,i]}return this.huntShip()}getDirection([t,e],[r,a]){return[r-t,a-e]}getNextCoordinate([t,e],[r,a]){return[t+r,e+a]}reverseDirection([t,e]){return[-t,-e]}findDirectionTarget(t){if(t.length<2)return null;const e=[...t].sort((([t,e],[r,a])=>t!==r?t-r:e-a)),r=t=>{const e=t[0],r=t[t.length-1];let a=this.getDirection(t[0],t[1]);const[s,i]=this.getNextCoordinate(r,a);if(this.isValidAttack(s,i))return[s,i];a=this.reverseDirection(a);const[o,n]=this.getNextCoordinate(e,a);return this.isValidAttack(o,n)?[o,n]:null};return r(t)||r(e)}updateAttackState(t,e,r){const a=t&&!t.isSunk(),s=this.currTargetShip&&this.currTargetShip.isSunk(),i=this.currTargetShip&&!this.currTargetShip.isSunk()&&this.currTargetShip.hitPositions.length>=2;a?(this.lastHit=[e,r],this.currTargetShip=t,this.currTargetShip.hitPositions.length>=2&&(this.nextTarget=this.findDirectionTarget(this.currTargetShip.hitPositions))):i&&(this.nextTarget=this.findDirectionTarget(this.currTargetShip.hitPositions),this.lastHit=null),s&&this.resetTargetState()}resetTargetState(){this.lastHit=null,this.nextTarget=null,this.currTargetShip=null}}class z{constructor(t){this.length=t,this.hits=0,this.hitPositions=[]}hit(t,e){this.hits<this.length&&(this.hits+=1,this.hitPositions.push([t,e]))}isSunk(){return this.hits>=this.length}}class M{constructor(t,e=5){this.ships=[new z(2),new z(3),new z(3),new z(4),new z(5)],this.currentPlayer=t,this.board=this.currentPlayer.gameboard.board,this.boardSize=this.currentPlayer.gameboard.boardSize,this.requiredShips=e}placePlayerShips(){var t,e;t=(t,e,r)=>{if(this.validPlacement(t)){const a=new z(e);this.placeShipOnBoard(a,t),P(r)}},e=this.validPlacement.bind(this),i.addEventListener("drop",(e=>{e.preventDefault();const{row:r,col:s,shipEl:o,offset:n,shipLength:l}=A(e),h=k(r,s,o,n);t(h,l,o),v(a.gameboard,i),document.querySelector(".restart-btn").classList.remove("disable","dim")})),i.addEventListener("dragover",(t=>{t.preventDefault(),document.querySelectorAll(".highlightShip").forEach((t=>{t.classList.remove("highlightShip")})),function(t,e){const{row:r,col:a,shipEl:s,offset:o}=A(t),n=k(r,a,s,o),l=e(n);document.querySelectorAll(".hovered").forEach((t=>{t.classList.remove("hovered","invalid")})),n.forEach((([t,e])=>{const r=i.querySelector(`[data-row="${t}"][data-col="${e}"]`);r&&(r.classList.add("hovered"),l||r.classList.add("invalid"))})),t.dataTransfer.dropEffect=l?"move":"none"}(t,e)})),i.addEventListener("dragleave",(()=>{document.querySelectorAll(".hovered").forEach((t=>{t.classList.remove("hovered","invalid")}))}))}placeComputerShips(){for(const t of this.ships){let e=!1;for(;!e;){const r=Math.random()<.5,[a,s]=this.getStartingPoint(t.length,r),i=this.getShipCoordinates(a,s,t.length,r);this.validPlacement(i)&&(this.placeShipOnBoard(t,i),e=!0)}}}placeShipOnBoard(t,e){this.currentPlayer.gameboard.placeShip(t,e)}validPlacement(t){return t.every((([t,e])=>{if(!this.inBounds(t,e)||"■"===this.board[t][e])return!1;const r=[[-1,0],[1,0],[0,-1],[0,1]];for(const[a,s]of r){const r=t+a,i=e+s;if(this.inBounds(r,i)&&"■"===this.board[r][i])return!1}return!0}))}inBounds(t,e){return t>=0&&t<this.boardSize&&e>=0&&e<this.boardSize}getShipCoordinates(t,e,r,a){const s=[];for(let i=0;i<r;i++)s.push(a?[t,e+i]:[t+i,e]);return s}getStartingPoint(t,e){const r=e?this.boardSize:this.boardSize-t,a=e?this.boardSize-t:this.boardSize;return[Math.floor(Math.random()*r),Math.floor(Math.random()*a)]}allPlaced(){return new Set(this.currentPlayer.gameboard.storeShip.values()).size===this.requiredShips}}const $=new class{constructor(t,e){this.player1=t,this.player2=e,this.currentPlayer=t,this.opponent=e,this.turnInterval=null,this.waitForPlayerInterval=null,this.gameOver=!1,this.playerShipPlacer=new M(this.player1),this.computerShipPlacer=new M(this.player2),this.AI=new x(this.player1.gameboard)}startSetup(){this.playerShipPlacer.placePlayerShips(),this.waitForPlayerInterval=setInterval((()=>{this.playerShipPlacer.allPlaced()&&(clearInterval(this.waitForPlayerInterval),L(this.player2,!0),setTimeout((()=>{this.gameOver||(this.computerShipPlacer.placeComputerShips(),v(this.player2.gameboard,o),L(this.player1))}),5e3))}),1e3)}processMoveResult(t,e){this.handleCellState(t),this.handleSunkShip(this.opponent,t,e),this.isWinner()&&this.endGame()}handlePlayerMove(t){if(this.gameOver)return;const[e,r]=w(t);this.opponent.gameboard.receiveAttack(e,r),this.processMoveResult(t,o),this.switchTurn(),clearInterval(this.turnInterval),this.turnInterval=setInterval((()=>this.handleComputerMove()),2e3)}handleComputerMove(){if(this.gameOver)return;const[t,e]=this.AI.computerAttacks(),r=i.querySelector(`[data-row="${t}"][data-col="${e}"]`);this.processMoveResult(r,i),this.switchTurn(),clearInterval(this.turnInterval),this.turnInterval=null}switchTurn(){this.isWinner()||(this.currentPlayer=this.currentPlayer===this.player1?this.player2:this.player1,this.opponent=this.currentPlayer===this.player1?this.player2:this.player1,L(this.currentPlayer))}handleSunkShip(t,e,r){const[a,s]=w(e),i=t.gameboard.storeShip.get(`${a},${s}`);if(i&&i.isSunk())for(const[e,a]of t.gameboard.storeShip)if(a===i&&a.isSunk()){const[a,s]=e.split(",").map((t=>Number(t)));t.gameboard.board[a][s]="sunk";const i=r.querySelector(`[data-row="${a}"][data-col="${s}"]`);i&&this.handleCellState(i)}}handleCellState(t){const[e,r]=w(t);f(this.opponent.gameboard.board[e][r],t)}isWinner(){return this.opponent.gameboard.allSunk()}endGame(){this.gameOver=!0,this.turnInterval&&(clearInterval(this.turnInterval),this.turnInterval=null),this.waitForPlayerInterval&&(clearInterval(this.waitForPlayerInterval),this.waitForPlayerInterval=null),function(t){const e=t.isComputer;o.classList.add("disable");const r=e?o:i,a=e?i:o,s=e?p:u;h.style.display="block",h.textContent=e?"Computer wins!":"You win!",c.textContent="",d.textContent="",r.classList.remove("dim"),a.classList.add("dim"),s.forEach((t=>t.classList.remove("dim"))),r.classList.add(e?"computer-shadow":"player-shadow"),l.classList.add("restart-btn-shadow")}(this.currentPlayer)}reset(){this.gameOver=!1,this.currentPlayer=this.player1,this.opponent=this.player2,this.turnInterval&&clearInterval(this.turnInterval),this.waitForPlayerInterval&&clearInterval(this.waitForPlayerInterval),this.turnInterval=null,this.waitForPlayerInterval=null,this.player1.gameboard.resetBoard(),this.player2.gameboard.resetBoard(),this.playerShipPlacer=new M(this.player1),this.computerShipPlacer=new M(this.player2),this.AI=new x(this.player1.gameboard)}}(a,s);document.addEventListener("DOMContentLoaded",(()=>{l.addEventListener("click",q),v(a.gameboard,i),v(s.gameboard,o),y(),C(),I(),T(),$.startSetup(),o.addEventListener("click",(t=>{const e=t.target.closest(".column");e&&$.handlePlayerMove(e)}))}))})();
//# sourceMappingURL=main.js.map